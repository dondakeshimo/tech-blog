<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#fdf6e3"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#fdf6e3"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description"/><meta property="og:title" content="マイクロサービスアーキテクチャのざっくりまとめ"/><meta property="og:type" content="website"/><meta property="og:url" content="{DOMAIN}/posts/2020-12-19-microservice_architecture"/><meta property="og:description"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta property="og:image:alt"/><meta property="og:site_name" content="dondakeshimoの丸太"/><meta property="og:locale" content="ja_JP"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:title" content="マイクロサービスアーキテクチャのざっくりまとめ"/><meta property="twitter:description"/><meta property="twitter:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta property="twitter:image:alt"/><meta property="twitter:site" content="dondakeshimo"/><meta property="twitter:creator" content="dondakeshimo"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><title>マイクロサービスアーキテクチャのざっくりまとめ | dondakeshimoの丸太</title><meta property="og:image" content="/assets/blog/dynamic-routing/cover.jpg"/><meta name="next-head-count" content="31"/><link rel="preload" href="/_next/static/css/0f9d9436e0b0760d86ae.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0f9d9436e0b0760d86ae.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-c034215587cd157b2989.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d2622b3552023a29a89a.js" defer=""></script><script src="/_next/static/chunks/cb1608f2-854db26f8877d6c8528f.js" defer=""></script><script src="/_next/static/chunks/a9a7754c-ecd5c258dd80f13aa656.js" defer=""></script><script src="/_next/static/chunks/349-e0275456508bca40c658.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-c414199f8f835e5668ae.js" defer=""></script><script src="/_next/static/yNrEyh5A0Oyk3eJQw5kY9/_buildManifest.js" defer=""></script><script src="/_next/static/yNrEyh5A0Oyk3eJQw5kY9/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-vfull"><main><div class="full-container mx-auto px-5"><a class="text-l font-bold text-tight mb-xl mt-l"><a class="logo" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="hand-point-up" class="svg-inline--fa fa-hand-point-up fa-w-12 svg-l dondake-icon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M135.652 0c23.625 0 43.826 20.65 43.826 44.8v99.851c17.048-16.34 49.766-18.346 70.944 6.299 22.829-14.288 53.017-2.147 62.315 16.45C361.878 158.426 384 189.346 384 240c0 2.746-.203 13.276-.195 16 .168 61.971-31.065 76.894-38.315 123.731C343.683 391.404 333.599 400 321.786 400H150.261l-.001-.002c-18.366-.011-35.889-10.607-43.845-28.464C93.421 342.648 57.377 276.122 29.092 264 10.897 256.203.008 242.616 0 224c-.014-34.222 35.098-57.752 66.908-44.119 8.359 3.583 16.67 8.312 24.918 14.153V44.8c0-23.45 20.543-44.8 43.826-44.8zM136 416h192c13.255 0 24 10.745 24 24v48c0 13.255-10.745 24-24 24H136c-13.255 0-24-10.745-24-24v-48c0-13.255 10.745-24 24-24zm168 28c-11.046 0-20 8.954-20 20s8.954 20 20 20 20-8.954 20-20-8.954-20-20-20z"></path></svg>dondakeshimoの丸太</a></a><article class="mb-2xl"><h1 class="title text-xl font-bold mb-l text-center">マイクロサービスアーキテクチャのざっくりまとめ</h1><div class="container-80 mx-auto"><div class="mb-l text-l"><time dateTime="2020-12-19">December	19, 2020</time></div></div><div class="container-80 mx-auto"><div><h1 id="目次">目次</h1>
<ul>
<li><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3">マイクロサービスアーキテクチャ</a>
<ul>
<li>
<ul>
<li><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E5%88%A9%E7%82%B9">マイクロサービスを用いる利点</a>
<ul>
<li>
<ul>
<li><a href="#%E6%8A%80%E8%A1%93%E7%95%B0%E8%B3%AA%E6%80%A7">技術異質性</a></li>
<li><a href="#%E5%9B%9E%E5%BE%A9%E6%80%A7resilience">回復性(Resilience)</a></li>
<li><a href="#%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0">スケーリング</a></li>
<li><a href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%AE%E5%AE%B9%E6%98%93%E6%80%A7">デプロイの容易性</a></li>
<li><a href="#%E7%B5%84%E7%B9%94%E9%9D%A2%E3%81%AE%E4%B8%80%E8%87%B4">組織面の一致</a></li>
<li><a href="#%E5%90%88%E6%88%90%E5%8F%AF%E8%83%BD%E6%80%A7">合成可能性</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88">マイクロサービスを用いるデメリット</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E5%8C%96">サービスのモデル化</a>
<ul>
<li>
<ul>
<li><a href="#%E5%84%AA%E3%82%8C%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9">優れたサービス</a>
<ul>
<li>
<ul>
<li><a href="#%E7%96%8E%E7%B5%90%E5%90%88">疎結合</a></li>
<li><a href="#%E9%AB%98%E5%87%9D%E9%9B%86%E6%80%A7">高凝集性</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%A2%83%E7%95%8C">境界</a>
<ul>
<li>
<ul>
<li><a href="#%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E7%9A%84%E5%A2%83%E7%95%8C">ビジネス的境界</a></li>
<li><a href="#%E6%8A%80%E8%A1%93%E7%9A%84%E5%A2%83%E7%95%8C">技術的境界</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%85%B1%E6%9C%89%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AF%E7%B5%B6%E5%AF%BE%E3%81%AB%E3%83%80%E3%83%A1">共有データベースは絶対にダメ</a></li>
<li><a href="#%E3%82%AA%E3%83%BC%E3%82%B1%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A8%E3%82%B3%E3%83%AC%E3%82%AA%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3">オーケストレーションとコレオグラフィ</a>
<ul>
<li>
<ul>
<li><a href="#%E3%82%AA%E3%83%BC%E3%82%B1%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">オーケストレーション</a></li>
<li><a href="#%E3%82%B3%E3%83%AC%E3%82%AA%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3">コレオグラフィ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rest%E3%81%A8rpc%E3%81%AE%E3%83%88%E3%83%AC%E3%83%BC%E3%83%89%E3%82%AA%E3%83%95">RESTとRPCのトレードオフ</a>
<ul>
<li>
<ul>
<li><a href="#rest">REST</a></li>
<li><a href="#rpc">RPC</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%99%E3%83%BC%E3%82%B9%E9%80%A3%E6%90%BA">非同期イベントベース連携</a></li>
<li><a href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA">クライアントライブラリ</a></li>
<li><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0">バージョニング</a></li>
<li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9">ユーザインタフェース</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4">デプロイ</a>
<ul>
<li>
<ul>
<li><a href="#cicd">CI/CD</a>
<ul>
<li>
<ul>
<li><a href="#%E7%B6%99%E7%B6%9A%E7%9A%84%E3%82%A4%E3%83%B3%E3%83%86%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">継続的インテグレーション</a></li>
<li><a href="#ci%E3%81%A8%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0">CIとマイクロサービスのマッピング</a></li>
<li><a href="#%E7%B6%99%E7%B6%9A%E7%9A%84%E3%83%87%E3%83%AA%E3%83%90%E3%83%AA">継続的デリバリ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%88%90%E6%9E%9C%E7%89%A9">成果物</a>
<ul>
<li>
<ul>
<li><a href="#%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E5%9B%BA%E6%9C%89%E3%81%AE%E6%88%90%E6%9E%9C%E7%89%A9">プラットフォーム固有の成果物</a></li>
<li><a href="#os%E6%88%90%E6%9E%9C%E7%89%A9">OS成果物</a></li>
<li><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%AE%E6%88%90%E6%9E%9C%E7%89%A9">カスタムイメージの成果物</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E6%A7%8B%E6%88%90">サービス構成</a>
<ul>
<li>
<ul>
<li><a href="#1%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AB%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9">1ホストに複数のサービス</a></li>
<li><a href="#%E3%83%9B%E3%82%B9%E3%83%88%E3%81%94%E3%81%A8%E3%81%AB%E4%B8%80%E3%81%A4%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9">ホストごとに一つのサービス</a></li>
<li><a href="#%E7%89%A9%E7%90%86%E3%81%A8%E4%BB%AE%E6%83%B3%E5%8C%96">物理と仮想化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%83%86%E3%82%B9%E3%83%88">テスト</a>
<ul>
<li>
<ul>
<li><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E7%A8%AE%E9%A1%9E">テストの種類</a>
<ul>
<li>
<ul>
<li><a href="#maric%E3%81%AE4%E8%B1%A1%E9%99%90">Maricの4象限</a></li>
<li><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97">テストのスコープ</a></li>
<li><a href="#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88">単体テスト</a></li>
<li><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%86%E3%82%B9%E3%83%88">サービステスト</a></li>
<li><a href="#end-to-end%E3%83%86%E3%82%B9%E3%83%88">End to Endテスト</a></li>
<li><a href="#%E3%82%B3%E3%83%B3%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%9E%E9%A7%86%E5%8B%95%E3%83%86%E3%82%B9%E3%83%88">コンシューマ駆動テスト</a></li>
<li><a href="#%E3%82%B9%E3%83%A2%E3%83%BC%E3%82%AF%E3%83%86%E3%82%B9%E3%83%88">スモークテスト</a></li>
<li><a href="#%E6%A9%9F%E8%83%BD%E6%A8%AA%E6%96%AD%E3%83%86%E3%82%B9%E3%83%88">機能横断テスト</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E3%83%86%E3%82%B9%E3%83%88">性能テスト</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%9B%A3%E8%A6%96">監視</a>
<ul>
<li>
<ul>
<li><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%82%A2%E3%83%89%E3%83%90%E3%82%A4%E3%82%B9">サービスについてのアドバイス</a></li>
<li><a href="#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%82%A2%E3%83%89%E3%83%90%E3%82%A4%E3%82%B9">システムについてのアドバイス</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3">セキュリティ</a></li>
<li><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E7%95%99%E6%84%8F%E7%82%B9">マイクロサービスにおける留意点</a>
<ul>
<li>
<ul>
<li><a href="#%E6%8C%87%E6%A8%99">指標</a></li>
<li><a href="#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E9%9A%9C%E5%AE%B3%E3%81%B8%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95">システム障害への対処法</a></li>
<li><a href="#cap%E5%AE%9A%E7%90%86">CAP定理</a></li>
<li><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA">サービスレジストリ</a></li>
<li><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E6%96%87%E6%9B%B8%E5%8C%96">サービスの文書化</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E5%8E%9F%E5%89%87">マイクロサービスの原則</a>
<ul>
<li>
<ul>
<li><a href="#%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E6%A6%82%E5%BF%B5%E3%81%AB%E6%B2%BF%E3%81%A3%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E5%8C%96">ビジネス概念に沿ったモデル化</a></li>
<li><a href="#%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AE%E6%96%87%E5%8C%96%E3%81%AE%E6%8E%A1%E7%94%A8">自動化の文化の採用</a></li>
<li><a href="#%E5%86%85%E9%83%A8%E5%AE%9F%E8%A3%85%E8%A9%B3%E7%B4%B0%E3%81%AE%E9%9A%A0%E8%94%BD">内部実装詳細の隠蔽</a></li>
<li><a href="#%E5%85%A8%E3%81%A6%E3%81%AE%E5%88%86%E6%95%A3%E5%8C%96">全ての分散化</a></li>
<li><a href="#%E7%8B%AC%E7%AB%8B%E3%81%97%E3%81%9F%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4">独立したデプロイ</a></li>
<li><a href="#%E9%9A%9C%E5%AE%B3%E3%81%AE%E5%88%86%E9%9B%A2">障害の分離</a></li>
<li><a href="#%E9%AB%98%E5%BA%A6%E3%81%AA%E8%A6%B3%E6%B8%AC">高度な観測</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="マイクロサービスアーキテクチャ">マイクロサービスアーキテクチャ</h1>
<p><a href="https://www.amazon.co.jp/%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3-Sam-Newman/dp/4873117607">マイクロサービスアーキテクチャ</a></p>
<p>上記の書籍をもとに学んだことをまとめていく。
まずマイクロサービスについての定義だが、</p>
<blockquote>
<p>マイクロサービスは、協調して動作する小規模で自律的なサービスです。</p>
</blockquote>
<p>とのことである。
かなり曖昧であるが、サービス群に対してどこからがマイクロなサービスのような具体的な線引くのは難しい。
本書で説明しているマイクロサービスの特徴としては</p>
<ul>
<li>一つの機能に専念していること</li>
<li>独立したデプロイが可能なこと</li>
</ul>
<p>の2点が担保されていることがマイクロサービスの条件となっているようである。</p>
<h3 id="マイクロサービスを用いる利点">マイクロサービスを用いる利点</h3>
<h5 id="技術異質性">技術異質性</h5>
<p>モノリシックなサービスに対し、技術選択の自由度が格段に上がる。
railsを使用して全てを管理しているアプリケーションにおいてrubyとJS以外のプログラミング言語を導入するのは容易ではないが、
適切にマイクロサービスに分割し機械学習分野に定評のあるPythonを推測部分に用いたり、
課金周りの処理には信頼と安定のJavaを使用したりなどといった選択が可能になる。</p>
<h5 id="回復性resilience">回復性(Resilience)</h5>
<p>システムのあるコンポーネントに障害が発生しても、その障害が連鎖しなければ、
問題を分離してシステムの残りの部分は機能し続けることができる。
モノリシックサービスでは一つの障害が全体に波及しやすい。</p>
<h5 id="スケーリング">スケーリング</h5>
<p>モノリシックサービスと違い、処理の重いサービスに集中的にリソースを割くということが可能になる。
そのため、一般的に柔軟なスケーリングが可能となりコストを制御することが容易になる。</p>
<h5 id="デプロイの容易性">デプロイの容易性</h5>
<p>大きなモノリシックサービスの軽微な変更に対してデプロイを行おうとすると、
変更量と釣り合わない長いビルド時間やリリース時間と戦う羽目になる。
また、リリースの失敗やバグ、障害の発生があると一気に全体に影響が出るため高頻度のリリースに精神的な障壁が生まれる。
サービスを分割した場合上記の懸念事項が軽減される。</p>
<h5 id="組織面の一致">組織面の一致</h5>
<p>1チームはピザ2枚で足りる人数が良い。
そのような小規模チームで巨大なモノリシックサービスを見切るのは至難の技である。
一つのサービスと一つのチームを結びつけられるように分割することで、効率よくマネジメントが可能になる。</p>
<h5 id="合成可能性">合成可能性</h5>
<p>分割されたサービスを再利用することが容易になる。
例えば、シューズストアサービスが参照していたユーザサービスを
新たに開発するブックストアサービスも参照するようにするといったことが簡単にできる。</p>
<h3 id="マイクロサービスを用いるデメリット">マイクロサービスを用いるデメリット</h3>
<p>明確に書籍には記述されていないがざっと思いつくものをまとめる。</p>
<ul>
<li>結局コストパフォーマンスが悪くなることがありそう</li>
<li>技術の自由度からチーム間の異動の際に学習コストが上がりそう</li>
<li>インタフェースが増えるのでその分事故も起きやすそう</li>
<li>理想のマイクロサービスの状態を全員が共有できていないとすぐにどこかで密結合が起こりそう</li>
</ul>
<h1 id="サービスのモデル化">サービスのモデル化</h1>
<h3 id="優れたサービス">優れたサービス</h3>
<h5 id="疎結合">疎結合</h5>
<p>あるサービスを変更しても別のサービスを変更する必要がない状態。</p>
<h5 id="高凝集性">高凝集性</h5>
<p>関連するビジネスロジックが一つのサービスに収まっている状態。
一つのロジックの振る舞いを変更したい時に、複数サービスにまたがって変更する必要がない状態。</p>
<h3 id="境界">境界</h3>
<h5 id="ビジネス的境界">ビジネス的境界</h5>
<p>大きなビジネスロジックを分解し、一つのビジネスロジックに着目した際外部との通信が必要な部分と必要のない部分に分割する。</p>
<h5 id="技術的境界">技術的境界</h5>
<p>分割の第一条件はビジネス境界であることを念頭に置く。技術的に分割できる部分は性能的な問題等を鑑みて分けても良い。</p>
<h3 id="共有データベースは絶対にダメ">共有データベースは絶対にダメ</h3>
<p>疎結合性と凝集性の真逆をいくプラクティスであるのでいかなる代償を払っても避けるべきである。</p>
<h3 id="オーケストレーションとコレオグラフィ">オーケストレーションとコレオグラフィ</h3>
<p>通信モードにおいて、リクエスト/レスポンスとイベントベースの二つが存在する。
サービス間の関係性として
リクエスト/レスポンスを用いたオーケストレーションと
イベントベースの通信を用いたコレオグラフィがある。
一般に、コレオグラフィ手法に向かう傾向が強いシステムの方が疎結合で柔軟性がある。
リクエスト/レスポンスを使用する際にも非同期にするように心がければ、疎結合性がある程度担保できる。</p>
<h5 id="オーケストレーション">オーケストレーション</h5>
<p>オーケストラの指揮者のように中枢部のサービスに頼ってプロセスを推進する。
指揮者サービスが各マイクロサービスとリクエスト/レスポンスを行い、
データを集めて最終的なレスポンスを形成するというようなモデルがオーケストレーションである。
メリットとしてはモデルが非常に分かりやすいこと、問題の特定が容易なこと。
デメリットは、指揮者サービスが中央監督機関になりすぎること。
中央集約しすぎるとほとんどのロジックをその部分で行うことが効率的となり、
結果的にモノリシックなサービスが出来上がってしまう方向に引力が働く可能性がある。</p>
<h5 id="コレオグラフィ">コレオグラフィ</h5>
<p>コレオグラフィはオーケストレーションとは違い中枢サービスがない。
代わりに入り口となっているサービスがイベントを発行し、
それらをサブスクライブしている各マイクロサービスがイベントをトリガーにプロセスを開始する。
一般的に問題特定やエラーハンドリングを行うことがオーケストレーションよりも難しくなる。</p>
<h3 id="restとrpcのトレードオフ">RESTとRPCのトレードオフ</h3>
<p>リクエスト/レスポンス方式の通信の代表的なものとしてREST(REpresentational State Transfer)とRPC(Remote Process Call)がある。
これら二つのトレードオフについて考える。</p>
<h5 id="rest">REST</h5>
<p>RESTの考え方とHTTPプロトコルは非常に相性が良いため、ここでは主にHTTPにおけるRESTについて考える。
HTTPリクエストを送ることによってリモートサーバに処理を依頼する。
ハイパーメディアコントロールにより、リソースにアクセスして次の操作を決定することが容易となり、サーバとクライアントの分離が進む。
欠点としては性能面や複雑さ、開発工数の増大などがある。</p>
<h5 id="rpc">RPC</h5>
<p>クライアントが単なる関数呼び出しを行うようにリモートサーバにリクエストを送れる手法である。
いくつかの問題として、クライアントサイドとサーバサイドの技術選択に制限がかかることや、
リモート呼び出しを抽象化しすぎた結果リモートサーバへのリクエストと気づかずに修正を入れてしまい事故につながるといったことがある。
最新のProtocol BuffersやThriftのような機構はこのようなデメリットを軽減している。</p>
<h3 id="非同期イベントベース連携">非同期イベントベース連携</h3>
<p>イベントベースの手法としてはメッセージキューを使用するものが代表的だろう。
HTTPを使用してAtomのような手法を使うことも可能である。
メッセージキューのインフラを整えるために追加の工数が大量に必要になるが、
完成した暁には大いなる疎結合性が得られる。</p>
<h3 id="クライアントライブラリ">クライアントライブラリ</h3>
<p>クライアントライブラリを使用する場合はクライアントサイドでアップグレードのタイミングを管理できるようにする。</p>
<h3 id="バージョニング">バージョニング</h3>
<p>バージョニングが必要な場合はセマンティックバージョニングを使用するのが良い。
2.1.5のように <code>MAJOR.MINOR.PATCH</code> と数字に意味を持たせる。
これによりアップグレードした際に破壊的な変更が行われているかどうかを察知することが可能となる。</p>
<p>その他の方式としては新旧のバージョンを共存させることが挙げられる。
どちらの方式も選べるような状態にし、旧バージョンを誰も参照しなくなった際に削除する。</p>
<p>前者は頻繁なアップデートを行うインターフェースに、後者はそれほど頻繁でないものに使用することができると考えられる。</p>
<h3 id="ユーザインタフェース">ユーザインタフェース</h3>
<p>合成レイヤと考え、レイヤと接続する各サービスがそのレイヤに対して責任を持つのが好ましい。
BFF(Backends for Frontends)を使用することでサービス呼び出しの管理が容易になるが、
BFFの層で中間ロジックを入れると複雑さが増すので注意が必要。</p>
<h1 id="デプロイ">デプロイ</h1>
<p>相互依存するマイクロサービスにおいてデプロイを適切に行うことは非常に重要である。
本章ではデプロイに関するテクニックや技術について言及する。</p>
<h3 id="cicd">CI/CD</h3>
<h5 id="継続的インテグレーション">継続的インテグレーション</h5>
<p>CI(Continuous Integration)は、新たにチェックインされたコードが既存コードと適切に統合されるようにする。
実際にCIを行っているかどうかの質問として</p>
<ul>
<li>1日に一度はメインラインにチェックインしているか</li>
<li>変更を検証するテストスイートがあるか</li>
<li>ビルドが壊れた時に、素rを修正するのがチームの最優先事項か</li>
</ul>
<p>というのがある。</p>
<h5 id="ciとマイクロサービスのマッピング">CIとマイクロサービスのマッピング</h5>
<p>CIを考える際に</p>
<ul>
<li>ソースコードリポジトリ</li>
<li>CIビルドジョブ</li>
<li>ビルド生成物</li>
</ul>
<p>の3つについてマッピングを考える必要がある。
最終的な生成物が3つ出来上がると考えた時に、CIビルドジョブまで3つに分割するか、ソースコードリポジトリまで3つに分割するかで
3パターン考えることができます。
一般にCIビルドジョブを一気にやる手法は考えることが少ないことをメリットとして捉えられるかもしれないが無駄捉えられるかもしれないが
CIビルドジョブを分割し、ソースコードリポジトリを分割しない場合はリポジトリが一つなので、
チェックイン/チェックアウトのプロセスが容易になる。
しかし、独立すべき複数のサービスを同時にレビューする習慣がつくため、密結合なコードに気付きづらくなるという欠点は抱えている。
ソースコードリポジトリまで分割した場合、リポジトリの所有権がチーム単位で明確になり、独立したレビューを行うことができるが、
リポジトリをまたがる変更が難しくなるというデメリットがある。</p>
<h5 id="継続的デリバリ">継続的デリバリ</h5>
<p>継続的デリバリ(CD: COntinuous Delivery)とはチェックインするたびに本番環境への準備状況に関する
フィードバックを常に得られ、さらに各チェックインを全てリリース候補として扱う手法である。
準備状況についてはビルドパイプラインによってステップに分けられて実行され、その成否において状況が判断できる。</p>
<h3 id="成果物">成果物</h3>
<p>リリースまで考えた際にソースコードの成果物として出力されるものの種類とそれらの特徴について考える。</p>
<h5 id="プラットフォーム固有の成果物">プラットフォーム固有の成果物</h5>
<p>Javaの場合はjarファイルとwarファイル、Pythonの場合はEggのようなプログラミング言語に対する成果物が生成される。
しかし、それを稼働させるためにはそれぞれの成果物を実行するための環境を整える必要がある。
環境を整えるためにはchefのような自動構成管理ツールが役に立つ。</p>
<h5 id="os成果物">OS成果物</h5>
<p>Red HatにおけるRPMやUbuntuにおけるdebのようなOS固有の成果物を生成する手法もある。
この場合、プラットフォーム固有の環境構築に依存する必要がなくなる。
しかし、OS固有の成果物の生成は一般に難易度が高いことや複数のOSにデプロイする場合には逆に手間がかかる可能性があるなどの欠点もある。</p>
<h5 id="カスタムイメージの成果物">カスタムイメージの成果物</h5>
<p>Puppet, Chef, Ansibleといった自動構成管理ツールの欠点は構成処理に時間がかかることである。
そのため、予め仮想マシンイメージを生成物とすることで各サーバへのデプロイ時間を軽減することができる。
また、イミュータブルサーバの概念を実現するのにも役に立つ。
この概念は端的にいうと、稼働中のサーバ郡は常に同じ状態にさせるために各々に対する変更は行わないようにするといったものである。
イメージを作成することで、SSH接続を不可にしてサーバを稼働させることが可能になり、概念としてのイミュータブルサーバを
より現実的なものとすることができる。</p>
<h3 id="サービス構成">サービス構成</h3>
<p>ホストとサービスをどのようにマッピングするかを考える。</p>
<h5 id="1ホストに複数のサービス">1ホストに複数のサービス</h5>
<p>スケールが難しい。
管理するホストが一つなのが楽。</p>
<h5 id="ホストごとに一つのサービス">ホストごとに一つのサービス</h5>
<p>スケールアウトが容易。管理するホストが複数になるので監視等のコストがかかる。</p>
<h5 id="物理と仮想化">物理と仮想化</h5>
<p>仮想化に対するキーワードを記載する。
最新の仮想化ではオーバーヘッドがかなり軽減され、進めるにつれて柔軟性や再現性が上がるという恩恵を得られる。</p>
<ul>
<li>Docker</li>
<li>Linuxコンテナ</li>
<li>Vagrand</li>
<li>ハイパーバイザ</li>
</ul>
<h1 id="テスト">テスト</h1>
<h3 id="テストの種類">テストの種類</h3>
<h5 id="maricの4象限">Maricの4象限</h5>
<p>Marickの4象限の派生系というものがある。
図を書くのが面倒なので、言葉で記載すが、4象限なので軸が二つあり、それぞれ <code>ビジネス &#x3C;-> 技術</code> , <code>プログラミングのサポートの大小</code> である。</p>
<ul>
<li>ビジネス、プログラミングのサポート小: 探索的テスト</li>
<li>ビジネス、プログラミングのサポート大: 受け入れテスト</li>
<li>技術、プログラミングのサポート小    : 性質テスト</li>
<li>技術、プログラミングのサポート大    : 単体テスト</li>
</ul>
<h5 id="テストのスコープ">テストのスコープ</h5>
<p>テストのスコープについては単体テストが最も狭く、End to Endテストが最も広い。
テストのスコープが大きくなるにつれてコードに対する自信が向上する。
テストのスコープが小さくなるにつれて実行時間が短くなり、分離性が向上する。</p>
<h5 id="単体テスト">単体テスト</h5>
<p>機能が適切かどうかに関して高速なフィードバックを得られることが単体テストの目的である。
コードのリファクタリングを支援するために非常に重要になる。</p>
<h5 id="サービステスト">サービステスト</h5>
<p>1マイクロサービスのみを対象としたテスト。
可動部がマイクロサービス単体に限定されているためテストの脆弱性が小さくなる。</p>
<h5 id="end-to-endテスト">End to Endテスト</h5>
<p>サービス全体を対象としたテスト。
テストの脆弱性は大きくなり問題箇所の特定も難しくなるが、成功した際に最も大きな自信が得られる。
その他にテストの責任者が曖昧になりやすいという組織上の欠点があったり、実行時間が大きくなりやすかったりとくつかの問題点を抱えている。</p>
<h5 id="コンシューマ駆動テスト">コンシューマ駆動テスト</h5>
<p>コンシューマ/クライアントがプロデューサ/サーバの試験を行う。
これにより確実にインタフェースの整合性が担保でき、End to Endテストよりも遥かに高速に試験が行える。
コンシューマ駆動テストを助けるツールとしてPactというものがある。</p>
<h5 id="スモークテスト">スモークテスト</h5>
<p>新たにデプロイしたソフトウェアに対して実行し、そのデプロイが正常に機能していることを確認する。
これを行うためにデプロイとリリースを分離する必要がある。</p>
<p><strong>ブルーグリーンデプロイメント</strong><br>
必要なサーバの倍量を準備しておき、半分に分割、片方にのみリクエストが流れる状態にする。
リクエストが来ていない側のサーバに新しいバージョンを行い、スモークテストを実施する。
スモークテストが成功したら、新しいバージョンにリクエストを流す。</p>
<p><strong>カナリアリリース</strong><br>
本番環境の一部に新しいバージョンをリリースする。
様々な観点から新しいバージョンに問題ないことを確認し、新しいバージョンの割合を最終的に100%にする。</p>
<h5 id="機能横断テスト">機能横断テスト</h5>
<p>非機能要件と呼ばれる通常の機能のように実装できないシステムの特性を表す用語があるが、その用語と同様のものとして機能横断要件というものを定義する。
多くの機能横断要件は本番環境のみでしか検証することができず、4象限で大別すると性質テストに当てはまる。
これらに関しては極力自動化できるようにするが不可能な部分は手動になり、臨機応変な対応が求められる。
多くの場合機能横断要件に関して検討されるのが遅いので、早めに考えるよう提案されている。</p>
<h5 id="性能テスト">性能テスト</h5>
<p>上記の機能横断要件の一部性能面を満たしているか確認するテストである。
性能テスト環境は本番環境と近しいものを用意する必要があり、努力が必要な場合が多いがボトルネックの特定など有意義な結果が得られる。</p>
<h1 id="監視">監視</h1>
<h3 id="サービスについてのアドバイス">サービスについてのアドバイス</h3>
<ul>
<li>最低でもインバウンド応答時間を追跡する。続いてエラー率、アプリケーションレベルのメトリクス。</li>
<li>全ての下流のレスポンスの健全性を追跡する。最低でも下流呼び出しの応答時間を追跡し、可能ならエラー率も追跡する。</li>
<li>メトリクスを収集する方法と場所を標準化する。</li>
<li>可能なら標準的な場所に標準形式でログを記録する。</li>
<li>基板となるOSを監視し、不正なプロセスを探し出して、キャパシティプランニングを実行できるようにする。</li>
</ul>
<h3 id="システムについてのアドバイス">システムについてのアドバイス</h3>
<ul>
<li>CPU使用率のようなホストレベルメトリクスはアプリケーションレベルのメトリクスと一緒に集約する。</li>
<li>メトリクス格納ツールを使用し、システムレベルまたはサービスレベルで集約、掘り下げができるようにする。</li>
<li>メトリクス格納ツールでシステムの傾向を把握するのに十分な期間のデータを保持できるようにする。</li>
<li>ログの集約と格納用にクエリ可能なツールを一つは導入する。</li>
<li>相関IDの標準化を検討する。</li>
<li>対応が必要な条件を理解し、アラートやダッシュボードを作成する。</li>
</ul>
<h1 id="セキュリティ">セキュリティ</h1>
<p>マイクロサービスを利用するとモノリシックサービスと比較して強固なセキュリティを築ける可能性が得られ、
セキュリティの手法に関する自由度も上がる。
SAMLやSSOなどの統合的な認証方法についてはさらに学ぶ必要があるが、その他は基本的なセキュリティ法則を遵守する。</p>
<h1 id="マイクロサービスにおける留意点">マイクロサービスにおける留意点</h1>
<h3 id="指標">指標</h3>
<ul>
<li>応答時間/遅延</li>
<li>可溶性</li>
<li>データの耐久性/損失性</li>
</ul>
<h3 id="システム障害への対処法">システム障害への対処法</h3>
<ul>
<li>タイムアウト</li>
<li>サーキットブレーカー</li>
<li>隔壁</li>
<li>分離</li>
</ul>
<h3 id="cap定理">CAP定理</h3>
<p>整合性(Consistency)、可用性(availability)、分断耐性(partition tolerance)の中で、
故障モードでは二つを得る。三つ全てを保証することはできない。
分断耐性を犠牲にすることはできないため、APシステムかCPシステムかで故障モードを考える必要がある。
ただし、どちらか一方に振り切る必要はない。</p>
<h3 id="サービスレジストリ">サービスレジストリ</h3>
<ul>
<li>DNS</li>
<li>ZooKeeper</li>
<li>Consul</li>
<li>Eureka</li>
<li>自作</li>
</ul>
<h3 id="サービスの文書化">サービスの文書化</h3>
<ul>
<li>Swagger</li>
<li>HALとHALブラウザ</li>
</ul>
<h1 id="マイクロサービスの原則">マイクロサービスの原則</h1>
<h3 id="ビジネス概念に沿ったモデル化">ビジネス概念に沿ったモデル化</h3>
<p>ビジネスで境界づけられたコンテキストを技術概念に基づいたインタフェースよりも優先する。</p>
<h3 id="自動化の文化の採用">自動化の文化の採用</h3>
<p>管理するものが多く、複雑なマイクロサービスにおいて、</p>
<ul>
<li>自動テストは必須</li>
<li>CI/CDは必須</li>
<li>カスタムイメージ/環境定義/イミュータブルサーバは推奨</li>
</ul>
<h3 id="内部実装詳細の隠蔽">内部実装詳細の隠蔽</h3>
<p>境界づけられたコンテキストをモデル化し、共有すべきモデルと隠すべきモデルを調べる。
サービスはデータベースを隠蔽し、データポンプや、イベントデータポンプを用いて
レポートのために複数のサービスからのデータを集約する。</p>
<h3 id="全ての分散化">全ての分散化</h3>
<p>チームにサービスを所有させる。
オーケストレーションではなくコレオグラフィとダムミドルウェアを選び、高度なエンドポイントを持たせる。</p>
<h3 id="独立したデプロイ">独立したデプロイ</h3>
<p>破壊的な変更が必要な時でもバージョン付けされたエンドポイントを共存させてコンシューマに対して後方互換性を持たせるべきである。
ホストごとに一つのサービスを持つようにするとブルーグリーンやカナリアといったリリーステクニックを使用できる。
コンシューマ駆動契約を用いて、破壊的変更が起こる前にそれについて察知する。
コンシューマが自ら更新のタイミングを決められるようにする。</p>
<h3 id="障害の分離">障害の分離</h3>
<p>リモート呼び出しをローカル呼び出しのように扱ってはいけない。
障害がどこでも起こりうることを念頭に対処法を施す。</p>
<h3 id="高度な観測">高度な観測</h3>
<p>セマンティック監視を利用して、ログと統計データは集約する。</p></div></div></article></div></main></div><footer><div class="full-container mx-auto px-5"><div class="full-container mx-auto px-5"><div class="py-m sns-container my-l"><div class="mx-s github-icon"><a href="https://github.com/dondakeshimo"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div><div class="mx-s twitter-icon"><a href="https://twitter.com/dondakeshimo"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"マイクロサービスアーキテクチャのざっくりまとめ","date":"2020-12-19","slug":"2020-12-19-microservice_architecture","author":{"name":"JJ Kasper","picture":"/assets/blog/authors/jj.jpeg"},"content":"\u003ch1 id=\"目次\"\u003e目次\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\"\u003eマイクロサービスアーキテクチャ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E5%88%A9%E7%82%B9\"\u003eマイクロサービスを用いる利点\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E6%8A%80%E8%A1%93%E7%95%B0%E8%B3%AA%E6%80%A7\"\u003e技術異質性\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%9B%9E%E5%BE%A9%E6%80%A7resilience\"\u003e回復性(Resilience)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0\"\u003eスケーリング\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%AE%E5%AE%B9%E6%98%93%E6%80%A7\"\u003eデプロイの容易性\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E7%B5%84%E7%B9%94%E9%9D%A2%E3%81%AE%E4%B8%80%E8%87%B4\"\u003e組織面の一致\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%90%88%E6%88%90%E5%8F%AF%E8%83%BD%E6%80%A7\"\u003e合成可能性\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"\u003eマイクロサービスを用いるデメリット\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E5%8C%96\"\u003eサービスのモデル化\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E5%84%AA%E3%82%8C%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9\"\u003e優れたサービス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E7%96%8E%E7%B5%90%E5%90%88\"\u003e疎結合\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E9%AB%98%E5%87%9D%E9%9B%86%E6%80%A7\"\u003e高凝集性\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%A2%83%E7%95%8C\"\u003e境界\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E7%9A%84%E5%A2%83%E7%95%8C\"\u003eビジネス的境界\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%8A%80%E8%A1%93%E7%9A%84%E5%A2%83%E7%95%8C\"\u003e技術的境界\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%85%B1%E6%9C%89%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AF%E7%B5%B6%E5%AF%BE%E3%81%AB%E3%83%80%E3%83%A1\"\u003e共有データベースは絶対にダメ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%AA%E3%83%BC%E3%82%B1%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A8%E3%82%B3%E3%83%AC%E3%82%AA%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3\"\u003eオーケストレーションとコレオグラフィ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%AA%E3%83%BC%E3%82%B1%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003eオーケストレーション\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B3%E3%83%AC%E3%82%AA%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3\"\u003eコレオグラフィ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#rest%E3%81%A8rpc%E3%81%AE%E3%83%88%E3%83%AC%E3%83%BC%E3%83%89%E3%82%AA%E3%83%95\"\u003eRESTとRPCのトレードオフ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#rest\"\u003eREST\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#rpc\"\u003eRPC\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%99%E3%83%BC%E3%82%B9%E9%80%A3%E6%90%BA\"\u003e非同期イベントベース連携\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\"\u003eクライアントライブラリ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0\"\u003eバージョニング\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9\"\u003eユーザインタフェース\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\"\u003eデプロイ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#cicd\"\u003eCI/CD\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E7%B6%99%E7%B6%9A%E7%9A%84%E3%82%A4%E3%83%B3%E3%83%86%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e継続的インテグレーション\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#ci%E3%81%A8%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0\"\u003eCIとマイクロサービスのマッピング\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E7%B6%99%E7%B6%9A%E7%9A%84%E3%83%87%E3%83%AA%E3%83%90%E3%83%AA\"\u003e継続的デリバリ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%88%90%E6%9E%9C%E7%89%A9\"\u003e成果物\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E5%9B%BA%E6%9C%89%E3%81%AE%E6%88%90%E6%9E%9C%E7%89%A9\"\u003eプラットフォーム固有の成果物\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#os%E6%88%90%E6%9E%9C%E7%89%A9\"\u003eOS成果物\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%AE%E6%88%90%E6%9E%9C%E7%89%A9\"\u003eカスタムイメージの成果物\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E6%A7%8B%E6%88%90\"\u003eサービス構成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#1%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AB%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9\"\u003e1ホストに複数のサービス\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%9B%E3%82%B9%E3%83%88%E3%81%94%E3%81%A8%E3%81%AB%E4%B8%80%E3%81%A4%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9\"\u003eホストごとに一つのサービス\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E7%89%A9%E7%90%86%E3%81%A8%E4%BB%AE%E6%83%B3%E5%8C%96\"\u003e物理と仮想化\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88\"\u003eテスト\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E7%A8%AE%E9%A1%9E\"\u003eテストの種類\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#maric%E3%81%AE4%E8%B1%A1%E9%99%90\"\u003eMaricの4象限\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97\"\u003eテストのスコープ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88\"\u003e単体テスト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%86%E3%82%B9%E3%83%88\"\u003eサービステスト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#end-to-end%E3%83%86%E3%82%B9%E3%83%88\"\u003eEnd to Endテスト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%9E%E9%A7%86%E5%8B%95%E3%83%86%E3%82%B9%E3%83%88\"\u003eコンシューマ駆動テスト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B9%E3%83%A2%E3%83%BC%E3%82%AF%E3%83%86%E3%82%B9%E3%83%88\"\u003eスモークテスト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%A9%9F%E8%83%BD%E6%A8%AA%E6%96%AD%E3%83%86%E3%82%B9%E3%83%88\"\u003e機能横断テスト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%80%A7%E8%83%BD%E3%83%86%E3%82%B9%E3%83%88\"\u003e性能テスト\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E7%9B%A3%E8%A6%96\"\u003e監視\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%82%A2%E3%83%89%E3%83%90%E3%82%A4%E3%82%B9\"\u003eサービスについてのアドバイス\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%82%A2%E3%83%89%E3%83%90%E3%82%A4%E3%82%B9\"\u003eシステムについてのアドバイス\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3\"\u003eセキュリティ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E7%95%99%E6%84%8F%E7%82%B9\"\u003eマイクロサービスにおける留意点\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E6%8C%87%E6%A8%99\"\u003e指標\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E9%9A%9C%E5%AE%B3%E3%81%B8%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95\"\u003eシステム障害への対処法\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#cap%E5%AE%9A%E7%90%86\"\u003eCAP定理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA\"\u003eサービスレジストリ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E6%96%87%E6%9B%B8%E5%8C%96\"\u003eサービスの文書化\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E5%8E%9F%E5%89%87\"\u003eマイクロサービスの原則\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E6%A6%82%E5%BF%B5%E3%81%AB%E6%B2%BF%E3%81%A3%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E5%8C%96\"\u003eビジネス概念に沿ったモデル化\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AE%E6%96%87%E5%8C%96%E3%81%AE%E6%8E%A1%E7%94%A8\"\u003e自動化の文化の採用\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%86%85%E9%83%A8%E5%AE%9F%E8%A3%85%E8%A9%B3%E7%B4%B0%E3%81%AE%E9%9A%A0%E8%94%BD\"\u003e内部実装詳細の隠蔽\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%85%A8%E3%81%A6%E3%81%AE%E5%88%86%E6%95%A3%E5%8C%96\"\u003e全ての分散化\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E7%8B%AC%E7%AB%8B%E3%81%97%E3%81%9F%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\"\u003e独立したデプロイ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E9%9A%9C%E5%AE%B3%E3%81%AE%E5%88%86%E9%9B%A2\"\u003e障害の分離\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E9%AB%98%E5%BA%A6%E3%81%AA%E8%A6%B3%E6%B8%AC\"\u003e高度な観測\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"マイクロサービスアーキテクチャ\"\u003eマイクロサービスアーキテクチャ\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://www.amazon.co.jp/%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3-Sam-Newman/dp/4873117607\"\u003eマイクロサービスアーキテクチャ\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e上記の書籍をもとに学んだことをまとめていく。\nまずマイクロサービスについての定義だが、\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eマイクロサービスは、協調して動作する小規模で自律的なサービスです。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eとのことである。\nかなり曖昧であるが、サービス群に対してどこからがマイクロなサービスのような具体的な線引くのは難しい。\n本書で説明しているマイクロサービスの特徴としては\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e一つの機能に専念していること\u003c/li\u003e\n\u003cli\u003e独立したデプロイが可能なこと\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eの2点が担保されていることがマイクロサービスの条件となっているようである。\u003c/p\u003e\n\u003ch3 id=\"マイクロサービスを用いる利点\"\u003eマイクロサービスを用いる利点\u003c/h3\u003e\n\u003ch5 id=\"技術異質性\"\u003e技術異質性\u003c/h5\u003e\n\u003cp\u003eモノリシックなサービスに対し、技術選択の自由度が格段に上がる。\nrailsを使用して全てを管理しているアプリケーションにおいてrubyとJS以外のプログラミング言語を導入するのは容易ではないが、\n適切にマイクロサービスに分割し機械学習分野に定評のあるPythonを推測部分に用いたり、\n課金周りの処理には信頼と安定のJavaを使用したりなどといった選択が可能になる。\u003c/p\u003e\n\u003ch5 id=\"回復性resilience\"\u003e回復性(Resilience)\u003c/h5\u003e\n\u003cp\u003eシステムのあるコンポーネントに障害が発生しても、その障害が連鎖しなければ、\n問題を分離してシステムの残りの部分は機能し続けることができる。\nモノリシックサービスでは一つの障害が全体に波及しやすい。\u003c/p\u003e\n\u003ch5 id=\"スケーリング\"\u003eスケーリング\u003c/h5\u003e\n\u003cp\u003eモノリシックサービスと違い、処理の重いサービスに集中的にリソースを割くということが可能になる。\nそのため、一般的に柔軟なスケーリングが可能となりコストを制御することが容易になる。\u003c/p\u003e\n\u003ch5 id=\"デプロイの容易性\"\u003eデプロイの容易性\u003c/h5\u003e\n\u003cp\u003e大きなモノリシックサービスの軽微な変更に対してデプロイを行おうとすると、\n変更量と釣り合わない長いビルド時間やリリース時間と戦う羽目になる。\nまた、リリースの失敗やバグ、障害の発生があると一気に全体に影響が出るため高頻度のリリースに精神的な障壁が生まれる。\nサービスを分割した場合上記の懸念事項が軽減される。\u003c/p\u003e\n\u003ch5 id=\"組織面の一致\"\u003e組織面の一致\u003c/h5\u003e\n\u003cp\u003e1チームはピザ2枚で足りる人数が良い。\nそのような小規模チームで巨大なモノリシックサービスを見切るのは至難の技である。\n一つのサービスと一つのチームを結びつけられるように分割することで、効率よくマネジメントが可能になる。\u003c/p\u003e\n\u003ch5 id=\"合成可能性\"\u003e合成可能性\u003c/h5\u003e\n\u003cp\u003e分割されたサービスを再利用することが容易になる。\n例えば、シューズストアサービスが参照していたユーザサービスを\n新たに開発するブックストアサービスも参照するようにするといったことが簡単にできる。\u003c/p\u003e\n\u003ch3 id=\"マイクロサービスを用いるデメリット\"\u003eマイクロサービスを用いるデメリット\u003c/h3\u003e\n\u003cp\u003e明確に書籍には記述されていないがざっと思いつくものをまとめる。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e結局コストパフォーマンスが悪くなることがありそう\u003c/li\u003e\n\u003cli\u003e技術の自由度からチーム間の異動の際に学習コストが上がりそう\u003c/li\u003e\n\u003cli\u003eインタフェースが増えるのでその分事故も起きやすそう\u003c/li\u003e\n\u003cli\u003e理想のマイクロサービスの状態を全員が共有できていないとすぐにどこかで密結合が起こりそう\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"サービスのモデル化\"\u003eサービスのモデル化\u003c/h1\u003e\n\u003ch3 id=\"優れたサービス\"\u003e優れたサービス\u003c/h3\u003e\n\u003ch5 id=\"疎結合\"\u003e疎結合\u003c/h5\u003e\n\u003cp\u003eあるサービスを変更しても別のサービスを変更する必要がない状態。\u003c/p\u003e\n\u003ch5 id=\"高凝集性\"\u003e高凝集性\u003c/h5\u003e\n\u003cp\u003e関連するビジネスロジックが一つのサービスに収まっている状態。\n一つのロジックの振る舞いを変更したい時に、複数サービスにまたがって変更する必要がない状態。\u003c/p\u003e\n\u003ch3 id=\"境界\"\u003e境界\u003c/h3\u003e\n\u003ch5 id=\"ビジネス的境界\"\u003eビジネス的境界\u003c/h5\u003e\n\u003cp\u003e大きなビジネスロジックを分解し、一つのビジネスロジックに着目した際外部との通信が必要な部分と必要のない部分に分割する。\u003c/p\u003e\n\u003ch5 id=\"技術的境界\"\u003e技術的境界\u003c/h5\u003e\n\u003cp\u003e分割の第一条件はビジネス境界であることを念頭に置く。技術的に分割できる部分は性能的な問題等を鑑みて分けても良い。\u003c/p\u003e\n\u003ch3 id=\"共有データベースは絶対にダメ\"\u003e共有データベースは絶対にダメ\u003c/h3\u003e\n\u003cp\u003e疎結合性と凝集性の真逆をいくプラクティスであるのでいかなる代償を払っても避けるべきである。\u003c/p\u003e\n\u003ch3 id=\"オーケストレーションとコレオグラフィ\"\u003eオーケストレーションとコレオグラフィ\u003c/h3\u003e\n\u003cp\u003e通信モードにおいて、リクエスト/レスポンスとイベントベースの二つが存在する。\nサービス間の関係性として\nリクエスト/レスポンスを用いたオーケストレーションと\nイベントベースの通信を用いたコレオグラフィがある。\n一般に、コレオグラフィ手法に向かう傾向が強いシステムの方が疎結合で柔軟性がある。\nリクエスト/レスポンスを使用する際にも非同期にするように心がければ、疎結合性がある程度担保できる。\u003c/p\u003e\n\u003ch5 id=\"オーケストレーション\"\u003eオーケストレーション\u003c/h5\u003e\n\u003cp\u003eオーケストラの指揮者のように中枢部のサービスに頼ってプロセスを推進する。\n指揮者サービスが各マイクロサービスとリクエスト/レスポンスを行い、\nデータを集めて最終的なレスポンスを形成するというようなモデルがオーケストレーションである。\nメリットとしてはモデルが非常に分かりやすいこと、問題の特定が容易なこと。\nデメリットは、指揮者サービスが中央監督機関になりすぎること。\n中央集約しすぎるとほとんどのロジックをその部分で行うことが効率的となり、\n結果的にモノリシックなサービスが出来上がってしまう方向に引力が働く可能性がある。\u003c/p\u003e\n\u003ch5 id=\"コレオグラフィ\"\u003eコレオグラフィ\u003c/h5\u003e\n\u003cp\u003eコレオグラフィはオーケストレーションとは違い中枢サービスがない。\n代わりに入り口となっているサービスがイベントを発行し、\nそれらをサブスクライブしている各マイクロサービスがイベントをトリガーにプロセスを開始する。\n一般的に問題特定やエラーハンドリングを行うことがオーケストレーションよりも難しくなる。\u003c/p\u003e\n\u003ch3 id=\"restとrpcのトレードオフ\"\u003eRESTとRPCのトレードオフ\u003c/h3\u003e\n\u003cp\u003eリクエスト/レスポンス方式の通信の代表的なものとしてREST(REpresentational State Transfer)とRPC(Remote Process Call)がある。\nこれら二つのトレードオフについて考える。\u003c/p\u003e\n\u003ch5 id=\"rest\"\u003eREST\u003c/h5\u003e\n\u003cp\u003eRESTの考え方とHTTPプロトコルは非常に相性が良いため、ここでは主にHTTPにおけるRESTについて考える。\nHTTPリクエストを送ることによってリモートサーバに処理を依頼する。\nハイパーメディアコントロールにより、リソースにアクセスして次の操作を決定することが容易となり、サーバとクライアントの分離が進む。\n欠点としては性能面や複雑さ、開発工数の増大などがある。\u003c/p\u003e\n\u003ch5 id=\"rpc\"\u003eRPC\u003c/h5\u003e\n\u003cp\u003eクライアントが単なる関数呼び出しを行うようにリモートサーバにリクエストを送れる手法である。\nいくつかの問題として、クライアントサイドとサーバサイドの技術選択に制限がかかることや、\nリモート呼び出しを抽象化しすぎた結果リモートサーバへのリクエストと気づかずに修正を入れてしまい事故につながるといったことがある。\n最新のProtocol BuffersやThriftのような機構はこのようなデメリットを軽減している。\u003c/p\u003e\n\u003ch3 id=\"非同期イベントベース連携\"\u003e非同期イベントベース連携\u003c/h3\u003e\n\u003cp\u003eイベントベースの手法としてはメッセージキューを使用するものが代表的だろう。\nHTTPを使用してAtomのような手法を使うことも可能である。\nメッセージキューのインフラを整えるために追加の工数が大量に必要になるが、\n完成した暁には大いなる疎結合性が得られる。\u003c/p\u003e\n\u003ch3 id=\"クライアントライブラリ\"\u003eクライアントライブラリ\u003c/h3\u003e\n\u003cp\u003eクライアントライブラリを使用する場合はクライアントサイドでアップグレードのタイミングを管理できるようにする。\u003c/p\u003e\n\u003ch3 id=\"バージョニング\"\u003eバージョニング\u003c/h3\u003e\n\u003cp\u003eバージョニングが必要な場合はセマンティックバージョニングを使用するのが良い。\n2.1.5のように \u003ccode\u003eMAJOR.MINOR.PATCH\u003c/code\u003e と数字に意味を持たせる。\nこれによりアップグレードした際に破壊的な変更が行われているかどうかを察知することが可能となる。\u003c/p\u003e\n\u003cp\u003eその他の方式としては新旧のバージョンを共存させることが挙げられる。\nどちらの方式も選べるような状態にし、旧バージョンを誰も参照しなくなった際に削除する。\u003c/p\u003e\n\u003cp\u003e前者は頻繁なアップデートを行うインターフェースに、後者はそれほど頻繁でないものに使用することができると考えられる。\u003c/p\u003e\n\u003ch3 id=\"ユーザインタフェース\"\u003eユーザインタフェース\u003c/h3\u003e\n\u003cp\u003e合成レイヤと考え、レイヤと接続する各サービスがそのレイヤに対して責任を持つのが好ましい。\nBFF(Backends for Frontends)を使用することでサービス呼び出しの管理が容易になるが、\nBFFの層で中間ロジックを入れると複雑さが増すので注意が必要。\u003c/p\u003e\n\u003ch1 id=\"デプロイ\"\u003eデプロイ\u003c/h1\u003e\n\u003cp\u003e相互依存するマイクロサービスにおいてデプロイを適切に行うことは非常に重要である。\n本章ではデプロイに関するテクニックや技術について言及する。\u003c/p\u003e\n\u003ch3 id=\"cicd\"\u003eCI/CD\u003c/h3\u003e\n\u003ch5 id=\"継続的インテグレーション\"\u003e継続的インテグレーション\u003c/h5\u003e\n\u003cp\u003eCI(Continuous Integration)は、新たにチェックインされたコードが既存コードと適切に統合されるようにする。\n実際にCIを行っているかどうかの質問として\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1日に一度はメインラインにチェックインしているか\u003c/li\u003e\n\u003cli\u003e変更を検証するテストスイートがあるか\u003c/li\u003e\n\u003cli\u003eビルドが壊れた時に、素rを修正するのがチームの最優先事項か\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eというのがある。\u003c/p\u003e\n\u003ch5 id=\"ciとマイクロサービスのマッピング\"\u003eCIとマイクロサービスのマッピング\u003c/h5\u003e\n\u003cp\u003eCIを考える際に\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eソースコードリポジトリ\u003c/li\u003e\n\u003cli\u003eCIビルドジョブ\u003c/li\u003e\n\u003cli\u003eビルド生成物\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eの3つについてマッピングを考える必要がある。\n最終的な生成物が3つ出来上がると考えた時に、CIビルドジョブまで3つに分割するか、ソースコードリポジトリまで3つに分割するかで\n3パターン考えることができます。\n一般にCIビルドジョブを一気にやる手法は考えることが少ないことをメリットとして捉えられるかもしれないが無駄捉えられるかもしれないが\nCIビルドジョブを分割し、ソースコードリポジトリを分割しない場合はリポジトリが一つなので、\nチェックイン/チェックアウトのプロセスが容易になる。\nしかし、独立すべき複数のサービスを同時にレビューする習慣がつくため、密結合なコードに気付きづらくなるという欠点は抱えている。\nソースコードリポジトリまで分割した場合、リポジトリの所有権がチーム単位で明確になり、独立したレビューを行うことができるが、\nリポジトリをまたがる変更が難しくなるというデメリットがある。\u003c/p\u003e\n\u003ch5 id=\"継続的デリバリ\"\u003e継続的デリバリ\u003c/h5\u003e\n\u003cp\u003e継続的デリバリ(CD: COntinuous Delivery)とはチェックインするたびに本番環境への準備状況に関する\nフィードバックを常に得られ、さらに各チェックインを全てリリース候補として扱う手法である。\n準備状況についてはビルドパイプラインによってステップに分けられて実行され、その成否において状況が判断できる。\u003c/p\u003e\n\u003ch3 id=\"成果物\"\u003e成果物\u003c/h3\u003e\n\u003cp\u003eリリースまで考えた際にソースコードの成果物として出力されるものの種類とそれらの特徴について考える。\u003c/p\u003e\n\u003ch5 id=\"プラットフォーム固有の成果物\"\u003eプラットフォーム固有の成果物\u003c/h5\u003e\n\u003cp\u003eJavaの場合はjarファイルとwarファイル、Pythonの場合はEggのようなプログラミング言語に対する成果物が生成される。\nしかし、それを稼働させるためにはそれぞれの成果物を実行するための環境を整える必要がある。\n環境を整えるためにはchefのような自動構成管理ツールが役に立つ。\u003c/p\u003e\n\u003ch5 id=\"os成果物\"\u003eOS成果物\u003c/h5\u003e\n\u003cp\u003eRed HatにおけるRPMやUbuntuにおけるdebのようなOS固有の成果物を生成する手法もある。\nこの場合、プラットフォーム固有の環境構築に依存する必要がなくなる。\nしかし、OS固有の成果物の生成は一般に難易度が高いことや複数のOSにデプロイする場合には逆に手間がかかる可能性があるなどの欠点もある。\u003c/p\u003e\n\u003ch5 id=\"カスタムイメージの成果物\"\u003eカスタムイメージの成果物\u003c/h5\u003e\n\u003cp\u003ePuppet, Chef, Ansibleといった自動構成管理ツールの欠点は構成処理に時間がかかることである。\nそのため、予め仮想マシンイメージを生成物とすることで各サーバへのデプロイ時間を軽減することができる。\nまた、イミュータブルサーバの概念を実現するのにも役に立つ。\nこの概念は端的にいうと、稼働中のサーバ郡は常に同じ状態にさせるために各々に対する変更は行わないようにするといったものである。\nイメージを作成することで、SSH接続を不可にしてサーバを稼働させることが可能になり、概念としてのイミュータブルサーバを\nより現実的なものとすることができる。\u003c/p\u003e\n\u003ch3 id=\"サービス構成\"\u003eサービス構成\u003c/h3\u003e\n\u003cp\u003eホストとサービスをどのようにマッピングするかを考える。\u003c/p\u003e\n\u003ch5 id=\"1ホストに複数のサービス\"\u003e1ホストに複数のサービス\u003c/h5\u003e\n\u003cp\u003eスケールが難しい。\n管理するホストが一つなのが楽。\u003c/p\u003e\n\u003ch5 id=\"ホストごとに一つのサービス\"\u003eホストごとに一つのサービス\u003c/h5\u003e\n\u003cp\u003eスケールアウトが容易。管理するホストが複数になるので監視等のコストがかかる。\u003c/p\u003e\n\u003ch5 id=\"物理と仮想化\"\u003e物理と仮想化\u003c/h5\u003e\n\u003cp\u003e仮想化に対するキーワードを記載する。\n最新の仮想化ではオーバーヘッドがかなり軽減され、進めるにつれて柔軟性や再現性が上がるという恩恵を得られる。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003eLinuxコンテナ\u003c/li\u003e\n\u003cli\u003eVagrand\u003c/li\u003e\n\u003cli\u003eハイパーバイザ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"テスト\"\u003eテスト\u003c/h1\u003e\n\u003ch3 id=\"テストの種類\"\u003eテストの種類\u003c/h3\u003e\n\u003ch5 id=\"maricの4象限\"\u003eMaricの4象限\u003c/h5\u003e\n\u003cp\u003eMarickの4象限の派生系というものがある。\n図を書くのが面倒なので、言葉で記載すが、4象限なので軸が二つあり、それぞれ \u003ccode\u003eビジネス \u0026#x3C;-\u003e 技術\u003c/code\u003e , \u003ccode\u003eプログラミングのサポートの大小\u003c/code\u003e である。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eビジネス、プログラミングのサポート小: 探索的テスト\u003c/li\u003e\n\u003cli\u003eビジネス、プログラミングのサポート大: 受け入れテスト\u003c/li\u003e\n\u003cli\u003e技術、プログラミングのサポート小    : 性質テスト\u003c/li\u003e\n\u003cli\u003e技術、プログラミングのサポート大    : 単体テスト\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"テストのスコープ\"\u003eテストのスコープ\u003c/h5\u003e\n\u003cp\u003eテストのスコープについては単体テストが最も狭く、End to Endテストが最も広い。\nテストのスコープが大きくなるにつれてコードに対する自信が向上する。\nテストのスコープが小さくなるにつれて実行時間が短くなり、分離性が向上する。\u003c/p\u003e\n\u003ch5 id=\"単体テスト\"\u003e単体テスト\u003c/h5\u003e\n\u003cp\u003e機能が適切かどうかに関して高速なフィードバックを得られることが単体テストの目的である。\nコードのリファクタリングを支援するために非常に重要になる。\u003c/p\u003e\n\u003ch5 id=\"サービステスト\"\u003eサービステスト\u003c/h5\u003e\n\u003cp\u003e1マイクロサービスのみを対象としたテスト。\n可動部がマイクロサービス単体に限定されているためテストの脆弱性が小さくなる。\u003c/p\u003e\n\u003ch5 id=\"end-to-endテスト\"\u003eEnd to Endテスト\u003c/h5\u003e\n\u003cp\u003eサービス全体を対象としたテスト。\nテストの脆弱性は大きくなり問題箇所の特定も難しくなるが、成功した際に最も大きな自信が得られる。\nその他にテストの責任者が曖昧になりやすいという組織上の欠点があったり、実行時間が大きくなりやすかったりとくつかの問題点を抱えている。\u003c/p\u003e\n\u003ch5 id=\"コンシューマ駆動テスト\"\u003eコンシューマ駆動テスト\u003c/h5\u003e\n\u003cp\u003eコンシューマ/クライアントがプロデューサ/サーバの試験を行う。\nこれにより確実にインタフェースの整合性が担保でき、End to Endテストよりも遥かに高速に試験が行える。\nコンシューマ駆動テストを助けるツールとしてPactというものがある。\u003c/p\u003e\n\u003ch5 id=\"スモークテスト\"\u003eスモークテスト\u003c/h5\u003e\n\u003cp\u003e新たにデプロイしたソフトウェアに対して実行し、そのデプロイが正常に機能していることを確認する。\nこれを行うためにデプロイとリリースを分離する必要がある。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eブルーグリーンデプロイメント\u003c/strong\u003e\u003cbr\u003e\n必要なサーバの倍量を準備しておき、半分に分割、片方にのみリクエストが流れる状態にする。\nリクエストが来ていない側のサーバに新しいバージョンを行い、スモークテストを実施する。\nスモークテストが成功したら、新しいバージョンにリクエストを流す。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eカナリアリリース\u003c/strong\u003e\u003cbr\u003e\n本番環境の一部に新しいバージョンをリリースする。\n様々な観点から新しいバージョンに問題ないことを確認し、新しいバージョンの割合を最終的に100%にする。\u003c/p\u003e\n\u003ch5 id=\"機能横断テスト\"\u003e機能横断テスト\u003c/h5\u003e\n\u003cp\u003e非機能要件と呼ばれる通常の機能のように実装できないシステムの特性を表す用語があるが、その用語と同様のものとして機能横断要件というものを定義する。\n多くの機能横断要件は本番環境のみでしか検証することができず、4象限で大別すると性質テストに当てはまる。\nこれらに関しては極力自動化できるようにするが不可能な部分は手動になり、臨機応変な対応が求められる。\n多くの場合機能横断要件に関して検討されるのが遅いので、早めに考えるよう提案されている。\u003c/p\u003e\n\u003ch5 id=\"性能テスト\"\u003e性能テスト\u003c/h5\u003e\n\u003cp\u003e上記の機能横断要件の一部性能面を満たしているか確認するテストである。\n性能テスト環境は本番環境と近しいものを用意する必要があり、努力が必要な場合が多いがボトルネックの特定など有意義な結果が得られる。\u003c/p\u003e\n\u003ch1 id=\"監視\"\u003e監視\u003c/h1\u003e\n\u003ch3 id=\"サービスについてのアドバイス\"\u003eサービスについてのアドバイス\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e最低でもインバウンド応答時間を追跡する。続いてエラー率、アプリケーションレベルのメトリクス。\u003c/li\u003e\n\u003cli\u003e全ての下流のレスポンスの健全性を追跡する。最低でも下流呼び出しの応答時間を追跡し、可能ならエラー率も追跡する。\u003c/li\u003e\n\u003cli\u003eメトリクスを収集する方法と場所を標準化する。\u003c/li\u003e\n\u003cli\u003e可能なら標準的な場所に標準形式でログを記録する。\u003c/li\u003e\n\u003cli\u003e基板となるOSを監視し、不正なプロセスを探し出して、キャパシティプランニングを実行できるようにする。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"システムについてのアドバイス\"\u003eシステムについてのアドバイス\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCPU使用率のようなホストレベルメトリクスはアプリケーションレベルのメトリクスと一緒に集約する。\u003c/li\u003e\n\u003cli\u003eメトリクス格納ツールを使用し、システムレベルまたはサービスレベルで集約、掘り下げができるようにする。\u003c/li\u003e\n\u003cli\u003eメトリクス格納ツールでシステムの傾向を把握するのに十分な期間のデータを保持できるようにする。\u003c/li\u003e\n\u003cli\u003eログの集約と格納用にクエリ可能なツールを一つは導入する。\u003c/li\u003e\n\u003cli\u003e相関IDの標準化を検討する。\u003c/li\u003e\n\u003cli\u003e対応が必要な条件を理解し、アラートやダッシュボードを作成する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"セキュリティ\"\u003eセキュリティ\u003c/h1\u003e\n\u003cp\u003eマイクロサービスを利用するとモノリシックサービスと比較して強固なセキュリティを築ける可能性が得られ、\nセキュリティの手法に関する自由度も上がる。\nSAMLやSSOなどの統合的な認証方法についてはさらに学ぶ必要があるが、その他は基本的なセキュリティ法則を遵守する。\u003c/p\u003e\n\u003ch1 id=\"マイクロサービスにおける留意点\"\u003eマイクロサービスにおける留意点\u003c/h1\u003e\n\u003ch3 id=\"指標\"\u003e指標\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e応答時間/遅延\u003c/li\u003e\n\u003cli\u003e可溶性\u003c/li\u003e\n\u003cli\u003eデータの耐久性/損失性\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"システム障害への対処法\"\u003eシステム障害への対処法\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eタイムアウト\u003c/li\u003e\n\u003cli\u003eサーキットブレーカー\u003c/li\u003e\n\u003cli\u003e隔壁\u003c/li\u003e\n\u003cli\u003e分離\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"cap定理\"\u003eCAP定理\u003c/h3\u003e\n\u003cp\u003e整合性(Consistency)、可用性(availability)、分断耐性(partition tolerance)の中で、\n故障モードでは二つを得る。三つ全てを保証することはできない。\n分断耐性を犠牲にすることはできないため、APシステムかCPシステムかで故障モードを考える必要がある。\nただし、どちらか一方に振り切る必要はない。\u003c/p\u003e\n\u003ch3 id=\"サービスレジストリ\"\u003eサービスレジストリ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eDNS\u003c/li\u003e\n\u003cli\u003eZooKeeper\u003c/li\u003e\n\u003cli\u003eConsul\u003c/li\u003e\n\u003cli\u003eEureka\u003c/li\u003e\n\u003cli\u003e自作\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"サービスの文書化\"\u003eサービスの文書化\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eSwagger\u003c/li\u003e\n\u003cli\u003eHALとHALブラウザ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"マイクロサービスの原則\"\u003eマイクロサービスの原則\u003c/h1\u003e\n\u003ch3 id=\"ビジネス概念に沿ったモデル化\"\u003eビジネス概念に沿ったモデル化\u003c/h3\u003e\n\u003cp\u003eビジネスで境界づけられたコンテキストを技術概念に基づいたインタフェースよりも優先する。\u003c/p\u003e\n\u003ch3 id=\"自動化の文化の採用\"\u003e自動化の文化の採用\u003c/h3\u003e\n\u003cp\u003e管理するものが多く、複雑なマイクロサービスにおいて、\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自動テストは必須\u003c/li\u003e\n\u003cli\u003eCI/CDは必須\u003c/li\u003e\n\u003cli\u003eカスタムイメージ/環境定義/イミュータブルサーバは推奨\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"内部実装詳細の隠蔽\"\u003e内部実装詳細の隠蔽\u003c/h3\u003e\n\u003cp\u003e境界づけられたコンテキストをモデル化し、共有すべきモデルと隠すべきモデルを調べる。\nサービスはデータベースを隠蔽し、データポンプや、イベントデータポンプを用いて\nレポートのために複数のサービスからのデータを集約する。\u003c/p\u003e\n\u003ch3 id=\"全ての分散化\"\u003e全ての分散化\u003c/h3\u003e\n\u003cp\u003eチームにサービスを所有させる。\nオーケストレーションではなくコレオグラフィとダムミドルウェアを選び、高度なエンドポイントを持たせる。\u003c/p\u003e\n\u003ch3 id=\"独立したデプロイ\"\u003e独立したデプロイ\u003c/h3\u003e\n\u003cp\u003e破壊的な変更が必要な時でもバージョン付けされたエンドポイントを共存させてコンシューマに対して後方互換性を持たせるべきである。\nホストごとに一つのサービスを持つようにするとブルーグリーンやカナリアといったリリーステクニックを使用できる。\nコンシューマ駆動契約を用いて、破壊的変更が起こる前にそれについて察知する。\nコンシューマが自ら更新のタイミングを決められるようにする。\u003c/p\u003e\n\u003ch3 id=\"障害の分離\"\u003e障害の分離\u003c/h3\u003e\n\u003cp\u003eリモート呼び出しをローカル呼び出しのように扱ってはいけない。\n障害がどこでも起こりうることを念頭に対処法を施す。\u003c/p\u003e\n\u003ch3 id=\"高度な観測\"\u003e高度な観測\u003c/h3\u003e\n\u003cp\u003eセマンティック監視を利用して、ログと統計データは集約する。\u003c/p\u003e","ogImage":{"url":"/assets/blog/dynamic-routing/cover.jpg"},"coverImage":"/assets/blog/dynamic-routing/cover.jpg"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2020-12-19-microservice_architecture"},"buildId":"yNrEyh5A0Oyk3eJQw5kY9","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>